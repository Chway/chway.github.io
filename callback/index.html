<!DOCTYPE html>
<html>

<head>
	<title>Authentication Success</title>
	<script>
		function handleAuthCallback() {
			if (!Object.hasOwn(self, "browser")) { self.browser = self.chrome; }

			const extensionId = "fcbcpllpoofphagdfjjobeempnepkpom";

			const params = new URLSearchParams(
				window.location.hash.substring(1) || window.location.search
			);

			const code = params.get("code");
			const oAuthToken = params.get("access_token");
			const state = params.get("state");

			if ((code || oAuthToken) && state) {
				try {
					browser.runtime.sendMessage(extensionId, {
						type: "OAUTH_EXTERNAL_SUCCESS",
						token: code ?? oAuthToken,
						state: state
					});
				} catch (e) {
					console.error("Could not send message to extension:", e);
				}
			} else {
				console.error("Authentication failed or token/state not found.", params.toString());
				browser.runtime.sendMessage(extensionId, {
					type: "OAUTH_EXTERNAL_FAILURE",
					error: "Token or state missing"
				});
			}

			window.close();
		}

		handleAuthCallback();
	</script>

</head>

<body>
	<h1>Processing Authentication...</h1>
	<p>Please wait...</p>
</body>

</html>